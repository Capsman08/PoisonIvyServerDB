<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Poison Ivy Reports Database</title>

		<link rel="stylesheet" href="/css/styles.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
 
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script type="text/javascript" src="/js/scripts.js"></script>

	</head>
	<body id="ivy-body">

		<div id="ivy-banner">
			<h1 id="ivy-banner-title" class="ivy-banner-item">ITCHY Project</h1>

			<div id="poison-ivy-link" class="ivy-banner-option ivy-banner-item">

				<p class="ivy-banner-option-text">Poison Ivy</p>

			</div>
		</div>

		<div id="container">

			<h2 id="project-title">Appalachian Trail Poison Ivy Data</h2>

			

			<h2 id="data-type-title">Reports Data</h3>

			<table class="table table-striped table-light">
				<thead>
					<tr>
						<th scope="col">ID</th>
						<th scope="col">User ID</th>
						<th scope="col">Plant Type</th>
						<th scope="col">Latitude</th>
						<th scope="col">Longitude</th>
						<th scope="col">Date/Time</th>
					</tr>

				</thead>
				<tbody id="reports-table-body">
					<script>

						var xhttp = new XMLHttpRequest();
				        xhttp.onload = function() {
						    if (this.status == 200) {
						    	var responseText = $.parseJSON(this.responseText);
						    	var numButtons = Math.ceil(responseText[0]['COUNT(*)'] / 10);
						    	//add the nav buttons
						    	for (i = 1; i < numButtons + 1; i++)
						    	{	
						    		var newButton = "<li class='page-item ' ><a class='page-link report-set'>" + i + "</a></li>";
						    		$("#reports-table-selector").append(newButton);
						    	}


						      
						    }
					  	};

					  	xhttp.open('GET', '/reportscount');
					  	xhttp.send();

						var xhttp2 = new XMLHttpRequest();
				        xhttp2.onload = function() {
						    if (this.status == 200) {
						    	var responseText = $.parseJSON(this.responseText);


						      	//populate the table
						      	for (i = 0; i < Math.min(responseText.length, 10); i++)
						      	{
					      			var newRowID = "<th scope='row' class='dynamic-report'>" + responseText[i].reportID + "</th>"; 
					      			var newRowUID = "<td class='dynamic-report'>" + responseText[i].UID + "</td>";
					      			var newRowPlantType = "<td class='dynamic-report'>" + responseText[i].plant_type + "</td>";
					      			var newRowLatitude = "<td class='dynamic-report'>" + responseText[i].latitude + "</td>";
					      			var newRowLongitude = "<td class='dynamic-report'>" + responseText[i].longitude + "</td>";
					      			var newRowDateTime = "<td class='dynamic-report'>" + responseText[i].date_time + "</td>";
					      			var newRow = "<tr class='dynamic-report'>" + newRowID + newRowUID + newRowPlantType + newRowLatitude + newRowLongitude + newRowDateTime + "</tr>";
					      			$("#reports-table-body").append(newRow);

						      	}

						      
						    }
					  	};

					  	xhttp2.open('GET', '/reports/0');
					  	xhttp2.send();

					  	//reset the table and add new stuff back in
					  	$("body").on( 'click', '.report-set', function() {
					  		$('.dynamic-report').remove();

					  		var xhttp3 = new XMLHttpRequest();
					        xhttp3.onload = function() {
							    if (this.status == 200) {
							    	var responseText = $.parseJSON(this.responseText);


							      	//populate the table
							      	for (i = 0; i < Math.min(responseText.length, 10); i++)
							      	{
						      			var newRowID = "<th scope='row' class='dynamic-report'>" + responseText[i].reportID + "</th>"; 
						      			var newRowUID = "<td class='dynamic-report'>" + responseText[i].UID + "</td>";
						      			var newRowPlantType = "<td class='dynamic-report'>" + responseText[i].plant_type + "</td>";
						      			var newRowLatitude = "<td class='dynamic-report'>" + responseText[i].latitude + "</td>";
						      			var newRowLongitude = "<td class='dynamic-report'>" + responseText[i].longitude + "</td>";
						      			var newRowDateTime = "<td class='dynamic-report'>" + responseText[i].date_time + "</td>";
						      			var newRow = "<tr class='dynamic-report'>" + newRowID + newRowUID + newRowPlantType + newRowLatitude + newRowLongitude + newRowDateTime + "</tr>";
						      			$("#reports-table-body").append(newRow);
							      	}

							      
							    }
						  	};

						  	xhttp3.open('GET', '/reports/' + ($(this).text() - 1));
						  	xhttp3.send();

					  	});

					</script>


				</tbody>
			</table>

			<nav id="data-page-selector" aria-label="Page navigation example">
			 	<ul id="reports-table-selector" class="pagination">

			 	</ul>
			</nav>

			<form action='/viewreports' method='get'>
				<button id="download-reports-csv-button" type="submit" class="btn btn-light download-csv-button">Download CSV file</button>
			</form>
			<script>

				$("#download-reports-csv-button").click( function () {
					var xhttp = new XMLHttpRequest();
			        xhttp.onload = function() {
					    if (this.status == 200) {
					    	responseText = this.responseText;
					      	window.alert(responseText);
					      
					    }
				  	};

				  	xhttp.open('GET', '/viewreports');
				  	xhttp.send();
				});

			</script>

			<h3 id="data-type-title">User Data</h3>

			<table class="table table-striped table-light">
				<thead>
					<tr>
						<th scope="col">ID</th>
						<th scope="col">Email</th>
						<th scope="col">Screen Name</th>
					</tr>

				</thead>
				<tbody id="users-table-body">
					
					<script>

						var xhttp = new XMLHttpRequest();
				        xhttp.onload = function() {
						    if (this.status == 200) {
						    	var responseText = $.parseJSON(this.responseText);
						    	var numButtons = Math.ceil(responseText[0]['COUNT(*)'] / 10);
						    	//add the nav buttons
						    	for (i = 1; i < numButtons + 1; i++)
						    	{	
						    		var newButton = "<li class='page-item ' ><a class='page-link user-set'>" + i + "</a></li>";
						    		$("#users-table-selector").append(newButton);
						    	}


						      
						    }
					  	};
					  	xhttp.open('GET', '/userscount');
					  	xhttp.send();



						var xhttp2 = new XMLHttpRequest();
				        xhttp2.onload = function() {
						    if (this.status == 200) {
						    	var responseText = $.parseJSON(this.responseText);


						      	//populate the table
						      	for (i = 0; i < responseText.length; i++)
						      	{
					      			var newRowUID = "<th scope='row' class='dynamic-user'>" + responseText[i].UID + "</th>"; 
					      			var newRowEmail = "<td class='dynamic-user'>" + responseText[i].email + "</td>";
					      			var newRowScreenname = "<td class='dynamic-user'>" + responseText[i].screenname + "</td>";
					      			var newRow = "<tr class='dynamic-user'>" + newRowUID + newRowEmail + newRowScreenname + "</tr>";
					      			$("#users-table-body").append(newRow);
						      	}

						      
						    }
					  	};

					  	xhttp2.open('GET', '/users');
					  	xhttp2.send();


					  	//reset the table and add new stuff back in
					  	$("body").on( 'click', '.user-set', function() {
					  		$('.dynamic-user').remove();

					  		var xhttp3 = new XMLHttpRequest();
					        xhttp3.onload = function() {
							    if (this.status == 200) {
							    	var responseText = $.parseJSON(this.responseText);


							      	//populate the table
							      	for (i = 0; i < Math.min(responseText.length, 10); i++)
							      	{
						      			var newRowUID = "<th scope='row' class='dynamic-user'>" + responseText[i].UID + "</th>"; 
						      			var newRowEmail = "<td class='dynamic-user'>" + responseText[i].email + "</td>";
						      			var newRowScreenname = "<td class='dynamic-user'>" + responseText[i].screenname + "</td>";
						      			var newRow = "<tr class='dynamic-user'>" + newRowUID + newRowEmail + newRowScreenname + "</tr>";
						      			$("#users-table-body").append(newRow);
							      	}

							      
							    }
						  	};

						  	xhttp3.open('GET', '/users/' + ($(this).text() - 1));
						  	xhttp3.send();

					  	});





					</script>

				</tbody>
			</table>

			<nav id="data-page-selector" aria-label="Page navigation example">
			 	<ul id='users-table-selector' class="pagination">

			 	</ul>
			</nav>

			<form action='/viewusers' method='get'>
				<button id="download-users-csv-button"  type="submit" class="btn btn-light download-csv-button">Download CSV file</button>
			</form>
			<!-- <script>

				$("#download-users-csv-button").click( function () {
					var xhttp = new XMLHttpRequest();
			        xhttp.onload = function() {
					    if (this.status == 200) {
					    	responseText = this.responseText;
					      	window.alert(responseText);
					      
					    }
				  	};

				  	xhttp.open('GET', '/viewusers');
				  	xhttp.send();
				});

			</script> -->

		</div> 


	</body>




</html>